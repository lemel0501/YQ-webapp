<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>YQ Notify · WebApp</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;margin:0;padding:16px;background:#f6fff3}
  .card{background:#fff;border:1px solid #cfe3d3;border-radius:14px;padding:14px;margin:10px auto;max-width:720px;box-shadow:0 8px 20px rgba(0,0,0,.05)}
  h3{margin:.3em 0 .6em}
  label{display:block;margin:.5em 0 .25em;font-weight:600}
  input,button{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #cfe3d3;border-radius:12px;font-size:16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .weekday{display:flex;gap:8px;flex-wrap:wrap}
  .weekday label{border:1px solid #cfe3d3;border-radius:999px;padding:.4em .8em;font-weight:500}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{background:#1e7f53;color:#fff;border:none;font-weight:700;cursor:pointer}
</style>

<body>
  <div class="card">
    <h3>📅 有效星期</h3>
    <div class="weekday">
      <label><input type="checkbox" id="wd0" checked> 週一</label>
      <label><input type="checkbox" id="wd1" checked> 週二</label>
      <label><input type="checkbox" id="wd2" checked> 週三</label>
      <label><input type="checkbox" id="wd3" checked> 週四</label>
      <label><input type="checkbox" id="wd4" checked> 週五</label>
      <label><input type="checkbox" id="wd5"> 週六</label>
      <label><input type="checkbox" id="wd6"> 週日</label>
    </div>
  </div>

  <div class="card">
    <h3>🔔 繼電器推播訊息（mon0..5）</h3>
    <div class="grid">
      <div><label>CH1 訊息</label><input id="mon0" placeholder="Relay 1"></div>
      <div><label>CH2 訊息</label><input id="mon1" placeholder="Relay 2"></div>
      <div><label>CH3 訊息</label><input id="mon2" placeholder="Relay 3"></div>
      <div><label>CH4 訊息</label><input id="mon3" placeholder="Relay 4"></div>
      <div><label>CH5 訊息</label><input id="mon4" placeholder="Relay 5"></div>
      <div><label>CH6 訊息</label><input id="mon5" placeholder="Relay 6"></div>
    </div>
  </div>

  <div class="card">
    <h3>🧮 計數器設定</h3>
    <label>#1 推播訊息（cm0）</label>
    <input id="cm0" placeholder="計數器#1">
    <div class="row">
      <div>
        <label>#1 達標門檻（cn0，0=停用）</label>
        <input id="cn0" type="number" min="0" step="1" value="0">
      </div>
    </div>
    <hr style="border:0;border-top:1px dashed #cfe3d3;margin:14px 0">
    <div class="row">
      <div>
        <label>#2 每日回報時間（ct1，HH:MM）</label>
        <input id="ct1" placeholder="17:30">
      </div>
      <div>
        <label>#2 推播訊息（cm1）</label>
        <input id="cm1" placeholder="計數器#2">
      </div>
    </div>
  </div>

  <div class="card">
    <button class="btn" id="send">送出到裝置（Telegram WebApp）</button>
  </div>

<script>
(function(){
  function pad2(n){return String(n).padStart(2,'0')}
  // Telegram WebApp SDK（由 Telegram 客戶端注入）
  const tg = window.Telegram && window.Telegram.WebApp;
  // 將表單收集成 JSON
  function collect(){
    const wd = [];
    for (let i=0;i<7;i++) wd.push(document.getElementById('wd'+i).checked ? 1 : 0);
    const mon = [];
    for (let i=0;i<6;i++) mon.push(document.getElementById('mon'+i).value||"");
    const cm0 = document.getElementById('cm0').value||"";
    const cn0 = parseInt(document.getElementById('cn0').value||"0",10)||0;
    const ct1 = (document.getElementById('ct1').value||"").trim();
    const cm1 = document.getElementById('cm1').value||"";
    return {wd, mon, cm0, cn0, ct1, cm1};
  }
  document.getElementById('send').addEventListener('click', function(){
    const data = JSON.stringify(collect());
    if (tg && tg.sendData){
      tg.sendData(data);     // ★ 送回聊天 → ESP 以 getUpdates 撈到 web_app_data
      tg.close();
    }else{
      alert("請從 Telegram 內開啟此頁（WebApp）");
    }
  });
})();
</script>
</body>

<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>YQ Notify · WebApp</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;margin:0;padding:16px;background:#f6fff3}
  .card{background:#fff;border:1px solid #cfe3d3;border-radius:14px;padding:14px;margin:10px auto;max-width:720px;box-shadow:0 8px 20px rgba(0,0,0,.05)}
  h3{margin:.3em 0 .6em}
  label{display:block;margin:.5em 0 .25em;font-weight:600}
  input,button{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #cfe3d3;border-radius:12px;font-size:16px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .weekday{display:flex;gap:8px;flex-wrap:wrap}
  .weekday label{border:1px solid #cfe3d3;border-radius:999px;padding:.4em .8em;font-weight:500}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{background:#1e7f53;color:#fff;border:none;font-weight:700;cursor:pointer}
</style>

<body>
  <div class="card">
    <h3>📅 有效星期</h3>
    <div class="weekday">
      <label><input type="checkbox" id="wd0" checked> 週一</label>
      <label><input type="checkbox" id="wd1" checked> 週二</label>
      <label><input type="checkbox" id="wd2" checked> 週三</label>
      <label><input type="checkbox" id="wd3" checked> 週四</label>
      <label><input type="checkbox" id="wd4" checked> 週五</label>
      <label><input type="checkbox" id="wd5"> 週六</label>
      <label><input type="checkbox" id="wd6"> 週日</label>
    </div>
  </div>

<!-- 🕒 定時排程（WebApp 版）：六路 HH:MM 與 保持時間 -->
<div class="card">
  <h3>🕒 定時排程（CH1~CH6）</h3>
  <p style="margin:.2em 0 .8em;color:#5b6b5f">設定每一路的觸發時間（HH:MM）與保持時間（分、秒；上限 3600 秒）。</p>

  <div class="grid">
    <!-- 6 路，兩欄一排 -->
    <div>
      <label>CH1 時間（t0）</label><input id="t0" placeholder="07:30">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm0）</label><input id="hm0" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs0）</label><input id="hs0" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>

    <div>
      <label>CH2 時間（t1）</label><input id="t1" placeholder="08:00">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm1）</label><input id="hm1" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs1）</label><input id="hs1" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>

    <div>
      <label>CH3 時間（t2）</label><input id="t2" placeholder="09:00">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm2）</label><input id="hm2" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs2）</label><input id="hs2" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>

    <div>
      <label>CH4 時間（t3）</label><input id="t3" placeholder="10:00">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm3）</label><input id="hm3" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs3）</label><input id="hs3" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>

    <div>
      <label>CH5 時間（t4）</label><input id="t4" placeholder="11:00">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm4）</label><input id="hm4" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs4）</label><input id="hs4" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>

    <div>
      <label>CH6 時間（t5）</label><input id="t5" placeholder="12:00">
      <div class="row" style="margin-top:6px">
        <div><label>分（hm5）</label><input id="hm5" type="number" min="0" max="59" value="0"></div>
        <div><label>秒（hs5）</label><input id="hs5" type="number" min="0" max="3600" value="5"></div>
      </div>
    </div>
  </div>
</div>
  <div class="card">
    <h3>🧮 計數器設定</h3>
    <label>#1 推播訊息（cm0）</label>
    <input id="cm0" placeholder="計數器#1">
    <div class="row">
      <div>
        <label>#1 達標門檻（cn0，0=停用）</label>
        <input id="cn0" type="number" min="0" step="1" value="0">
      </div>
    </div>
    <hr style="border:0;border-top:1px dashed #cfe3d3;margin:14px 0">
    <div class="row">
      <div>
        <label>#2 每日回報時間（ct1，HH:MM）</label>
        <input id="ct1" placeholder="17:30">
      </div>
      <div>
        <label>#2 推播訊息（cm1）</label>
        <input id="cm1" placeholder="計數器#2">
      </div>
    </div>
  </div>

  <div class="card">
    <button class="btn" id="send">送出到裝置（Telegram WebApp）</button>
  </div>

<script>
(function () {
  // 1) 取得 Telegram WebApp 物件並就緒/展開
  const tg = window.Telegram && window.Telegram.WebApp;
  if (tg && tg.ready) tg.ready();
  if (tg && tg.expand) tg.expand();

  // 2) 收集表單 → 回傳 JSON（請保證這些欄位在頁面上）
  function collect() {
    const wd = [];
    for (let i = 0; i < 7; i++) {
      const el = document.getElementById('wd' + i);
      if (el) wd.push(el.checked ? 1 : 0);
    }
    const ts = [], hm = [], hs = [];
    for (let i = 0; i < 6; i++) {
      ts.push((document.getElementById('t' + i)?.value || '').trim());
      hm.push(parseInt(document.getElementById('hm' + i)?.value || '0', 10) || 0);
      hs.push(parseInt(document.getElementById('hs' + i)?.value || '0', 10) || 0);
    }
    const cm0 = document.getElementById('cm0')?.value || '';
    const cn0 = parseInt(document.getElementById('cn0')?.value || '0', 10) || 0;
    const ct1 = (document.getElementById('ct1')?.value || '').trim();
    const cm1 = document.getElementById('cm1')?.value || '';
    return { wd, ts, hm, hs, cm0, cn0, ct1, cm1 };
  }

  // 3) 綁定「送出到裝置」按鈕
  const btn = document.getElementById('send');
  btn.addEventListener('click', function () {
    if (!(tg && tg.sendData)) {
      alert('請從 Telegram 內開啟此頁（點聊天裡的「⚙️ 開啟設定」），外部瀏覽器無法送出。');
      return;
    }
    const data = JSON.stringify(collect());
    if (tg.showAlert) tg.showAlert('已送出設定到聊天，裝置將在 1–2 秒內套用。');
    tg.sendData(data);              // 回傳到聊天（web_app_data）
    if (tg.close) tg.close();
  });

  // 4) （可選）顯示底部主按鈕
  if (tg && tg.MainButton) {
    tg.MainButton.setText('送出到裝置');
    tg.MainButton.onClick(() => btn.click());
    tg.MainButton.show();
  }
})();
</script>
</body>





